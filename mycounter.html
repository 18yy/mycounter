<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>myCounter</title>
</head>

<body>
  <label for="qustionNum">题目个数：</label>
  <input type="text" id="qustionNum">
  <br/>
  <label for="maxNum">运算不超过的数字:</label>
  <input type="text" id="maxNum">
  <br/>
  <button type="button" onclick="playAll()">开始生成题目</button>
  <span id="text"></span>
  <script>
    //随机函数，获得min到max范围内的随机数包括min和max
    function getRandomNum(min, max) {
      var range = max - min;
      return (Math.round(Math.random() * range + min));
    }

    //求最大公约数
    function getGCD(a, b) {
      var temp;
      while (b != 0) {
        temp = a % b;
        a = b;
        b = temp;
      }
      return a;
    }
    
    //转化成分数的形式
    function getFract(a, b, gcd) {
      if (gcd == 1) {
        if (a > b) {
          //最大公约数为1且分子大于分母，用真分数形式表示
          var n = parseInt(a / b);
          a = a % b;
          return n + "'" + a + "/" + b;
        } else {
          return a + "/" + b;
        }
      } else if(gcd == b) {
      	return a/b;
      } else {
        a = a / gcd;
        b = b / gcd;
        return a + "/" + b;
      }
    }

    //把分数转化为真分数或整数
    function TrueFract(molecule,denominator) {
       if(molecule % denominator !== 0) {
            var gcd = getGCD(molecule,denominator);
            var sum = getFract(molecule,denominator,gcd);
        }else {
            var sum = molecule / denominator;
        }
        return sum;
    }

    //整数的随机四则运算
    function countInt(a, b, operator, maxNum) {
      //匹配运算符
      switch (operator) {
        case "+":
          {
            return a + b;
            break;
          }
        case "-":
          {
            var sum = a - b;
            //如果是负数情况，重新随机生成数直到结果非负
            while (sum < 0) {
              var a = getRandomNum(1, maxNum);
              var b = getRandomNum(1, maxNum);
              var sum = a - b;
            }
            return sum;
            break;
          }
        case "x":
          {
            return a * b;
            break;
          }
        case "÷":
          {
          	while(b == 0) {
          	    var b = getRandomNum(1, maxNum);
          	}
          	//如果分子不能整除分母，运行getFract函数把答案变成分数形式
            var sum = TrueFract(a,b);
            return sum;
            break;
          }

        default:
          break;
      }
    }

    //分数的随机四则运算
    function countFract(a, b, c, d, operator, maxNum){
       //匹配运算符
      switch (operator) {
        case "+":
          {
            var molecule = a * d + b * c;
            var denominator = c * d;
            var TrueFractA = TrueFract(a,c);
            var TrueFractB = TrueFract(b,d);
            var sum = TrueFract(molecule,denominator);
            return TrueFractA + "+" + TrueFractB + "=" + sum;
            break;
          }
        case "-":
          {
            var molecule = a * d - b * c;
            //如果是负数情况，重新随机生成数直到结果非负
            while(molecule < 0) {
              var a = getRandomNum(1, maxNum);
              var b = getRandomNum(1, maxNum);
              var c = getRandomNum(1, maxNum);
              var d = getRandomNum(1, maxNum);
              var molecule = a * d - b * c;
            }
            if(molecule == 0) {
            	var sum = 0;
            }else {
            	var denominator = c * d;
            	var TrueFractA = TrueFract(a,c);
                var TrueFractB = TrueFract(b,d);
                var sum = TrueFract(molecule,denominator);
            }
            return TrueFractA + "-" + TrueFractB + "=" + sum;
            break;
          }
        case "x":
          {
            var molecule = a * b;
            var denominator = c * d;
            var TrueFractA = TrueFract(a,c);
            var TrueFractB = TrueFract(b,d);
            var sum = TrueFract(molecule,denominator);
            return TrueFractA + "x" + TrueFractB + "=" + sum;
            break;
          }
        case "÷":
          {
            var molecule = a * d;
            var denominator = c * b;
            var TrueFractA = TrueFract(a,c);
            var TrueFractB = TrueFract(b,d);
            var sum = TrueFract(molecule,denominator);
            return TrueFractA + "÷" + TrueFractB + "=" + sum;
            break;
          }

        default:
        break;
      }

    }

    function countInt2(a, b, c, operator1, operator2, maxNum) {
        switch (operator1) {
        case "+":
          {
          	if(operator2 == "x" || operator2 == "÷") {
          	    var temp = countInt(b, c, operator2, maxNum);
          		var sum = countInt(a, temp, operator1, maxNum);
          		return sum;
          	}else {
          		var temp = countInt(a, b, operator1, maxNum);
          		var sum = countInt(temp, c, operator2, maxNum);
          		return sum;
          	}
            break;
          }
        case "-":
          {
            if(operator2 == "x" || operator2 == "÷") {
          		var temp = countInt(b, c, operator2, maxNum);
          		var sum = countInt(a, temp, operator1, maxNum);
          	}else {
          		var temp = countInt(a, b, operator1, maxNum);
          		var sum = countInt(temp, c, operator2, maxNum);
          	}
            //如果是负数情况，重新随机生成数直到结果非负
            while (sum < 0) {
                var a = getRandomNum(1, maxNum);
                var b = getRandomNum(1, maxNum);
                var c = getRandomNum(1, maxNum);
                if(operator2 == "x" || operator2 == "÷") {
          		    var temp = countInt(b, c, operator2, maxNum);
          		    var sum = countInt(a, temp, operator1, maxNum);
          	    }else {
          		    var temp = countInt(a, b, operator1, maxNum);
          		    var sum = countInt(temp, c, operator2, maxNum);
          	    }
            }
            return sum;
            break;
          }
        case "x":
          {
          	var temp = countInt(a, b, operator1, maxNum);
          	var sum = countInt(temp, c, operator2, maxNum);
          	return sum;
            break;
          }
        case "÷":
          {
            var temp = countInt(a, b, operator1, maxNum);
          	var sum = countInt(temp, c, operator2, maxNum);
          	return sum;
            break;
          }

        default:
        break;
      }
    }

    function countInt3(a, b, c, d, operator1, operator2, operator3, maxNum) {
        switch (operator1) {
        case "+":
          {
          	var temp = countInt2(b, c, d, operator2, operator3, maxNum);
          	var sum = countInt(a, temp, operator1, maxNum);
          	return sum;
            break;
          }
        case "-":
          {
            var temp = countInt2(b, c, d, operator2, operator3, maxNum);
          	var sum = countInt(a, temp, operator1, maxNum);
          	//如果是负数情况，重新随机生成数直到结果非负
            while (sum < 0) {
              var a = getRandomNum(1, maxNum);
              var b = getRandomNum(1, maxNum);
              var c = getRandomNum(1, maxNum);
              var temp = countInt2(b, c, d, operator2, operator3, maxNum);
          	  var sum = countInt(a, temp, operator1, maxNum);
            }
            return sum;
            break;
          }
        case "x":
          {
          	var temp = countInt(a, b, operator1, maxNum);
          	var sum = countInt2(temp, c, d, operator2, operator3, maxNum);
          	return sum;
            break;
          }
        case "÷":
          {
            var temp = countInt(a, b, operator1, maxNum);
          	var sum = countInt2(temp, c, d, operator2, operator3, maxNum);
          	return sum;
            break;
          }

        default:
        break;
      }
    }

    //运行countInt函数
    function playCountInt(maxNum) {
        var arry = ["+", "-", "x", "÷"];
        var num = [];
        var operator1 = arry[getRandomNum(0, 3)];
        var operator2 = arry[getRandomNum(0, 3)];
        var operator3 = arry[getRandomNum(0, 3)];
        for(var i=0;i<8;i++) {
        	num[i] = getRandomNum(1, maxNum);
        }
        /*var a = getRandomNum(1, maxNum);
        var b = getRandomNum(1, maxNum);
        var c = getRandomNum(1, maxNum);
        var d = getRandomNum(1, maxNum);
        var e = getRandomNum(1, maxNum);
        var f = getRandomNum(1, maxNum);
        var g = getRandomNum(1, maxNum);
        var h = getRandomNum(1, maxNum);*/
        var IsInt = getRandomNum(0,1);
        var operator_num = getRandomNum(1,3);
        if(IsInt == 1) {
        switch(operator_num) {
            case 1: 
            {
                var sum = countInt(num[0], num[1], operator1, maxNum);
                var result = num[0] + operator1 + num[1] + "=" + sum;
                break;
            }
            case 2:
            {
                var sum = countInt2(num[0], num[1], num[2], operator1, operator2, maxNum);
                var result = num[0] + operator1 + num[1] + operator2 + num[2] + "=" + sum;
                break;
            }
            case 3:
            {
                var sum = countInt3(num[0], num[1], num[2], num[3], operator1, operator2, operator3, maxNum);
                var result = num[0] + operator1 + num[1] + operator2 + num[2] + operator2 + num[3] + "=" + sum;
                break;
            }
        }
    }else 
        var result = countFract(num[0], num[1], num[2], num[3], operator1, maxNum);
      return result;
    }

    function playAll() {
      //将页面清空
      document.getElementById("text").innerHTML = "";
      //题目数目
      var qustionNum = document.getElementById("qustionNum").value;
      //运算范围，最大运算数字
      var maxNum = document.getElementById("maxNum").value;
      for (i = 1; i <= qustionNum; i++) {

        document.getElementById("text").innerHTML += ("<br>" + "第" + i + "题：");

        var answer = playCountInt(maxNum);
        document.getElementById("text").innerHTML += (answer);

      }
    }
  </script>
</body>

</html>